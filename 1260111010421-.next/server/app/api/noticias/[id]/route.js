"use strict";(()=>{var e={};e.id=3875,e.ids=[3875],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},56878:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>j,routeModule:()=>w,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y});var s={};n.r(s),n.d(s,{DELETE:()=>g,GET:()=>p,PUT:()=>f});var r=n(43410),a=n(88716),o=n(60670),i=n(87070),d=n(2095),u=n(17044);let l=new Set(["eventos","classificados","geral","dicas"]);async function c(e,t){let n=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||`noticia-${Date.now()}`,s=n,r=1;for(;;){let e=await u.db.news.findBySlug(s);if(!e||e.id===t)return s;s=`${n}-${r++}`}}async function p(e,{params:t}){try{let n=(0,d.Sk)(e),s=await u.db.news.findById(t.id);if(!s)return i.NextResponse.json({error:"Noticia nao encontrada"},{status:404});if("published"!==s.status&&n?.role!=="admin")return i.NextResponse.json({error:"Acesso negado"},{status:403});return i.NextResponse.json({news:s})}catch(e){return console.error("Erro ao buscar noticia:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function f(e,{params:t}){try{(0,d.kF)(e);let n=await u.db.news.findById(t.id);if(!n)return i.NextResponse.json({error:"Noticia nao encontrada"},{status:404});let s=await e.json(),r={};if("string"==typeof s?.title&&s.title.trim()){let e=s.title.trim();r.title=e,r.slug=await c(e,n.id)}"string"==typeof s?.content&&s.content.trim()&&(r.content=s.content.trim()),"string"==typeof s?.excerpt&&s.excerpt.trim()&&(r.excerpt=s.excerpt.trim()),"string"==typeof s?.category&&l.has(s.category)&&(r.category=s.category),"string"==typeof s?.coverImage&&s.coverImage.trim()&&(r.coverImage=s.coverImage.trim()),"string"==typeof s?.author&&s.author.trim()&&(r.author=s.author.trim()),(s?.status==="draft"||s?.status==="published")&&(r.status=s.status);let a=await u.db.news.update(t.id,r);if(!a)return i.NextResponse.json({error:"Noticia nao encontrada"},{status:404});return i.NextResponse.json({news:a,message:"Noticia atualizada com sucesso"})}catch(e){if(console.error("Erro ao atualizar noticia:",e),e instanceof Error){let t=e.message.toLowerCase();if(t.includes("acesso negado"))return i.NextResponse.json({error:"Acesso negado"},{status:401});if(t.includes("autoriz"))return i.NextResponse.json({error:"Nao autorizado"},{status:401})}return i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function g(e,{params:t}){try{if((0,d.kF)(e),!await u.db.news.findById(t.id))return i.NextResponse.json({error:"Noticia nao encontrada"},{status:404});return await u.db.news.delete(t.id),i.NextResponse.json({message:"Noticia excluida com sucesso"})}catch(e){if(console.error("Erro ao excluir noticia:",e),e instanceof Error){let t=e.message.toLowerCase();if(t.includes("acesso negado"))return i.NextResponse.json({error:"Acesso negado"},{status:401});if(t.includes("autoriz"))return i.NextResponse.json({error:"Nao autorizado"},{status:401})}return i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let w=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/noticias/[id]/route",pathname:"/api/noticias/[id]",filename:"route",bundlePath:"app/api/noticias/[id]/route"},resolvedPagePath:"C:\\Users\\lucas\\OneDrive\\Documentos\\GitHub\\AutoGarageShowV1\\src\\app\\api\\noticias\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:y,serverHooks:m}=w,S="/api/noticias/[id]/route";function h(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:y})}},2095:(e,t,n)=>{function s(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;let n=t.substring(7);return JSON.parse(atob(n))}catch{return null}}function r(e){let t=s(e);if(!t)throw Error("N\xe3o autorizado");return t}function a(e){let t=r(e);if("admin"!==t.role)throw Error("Acesso negado");return t}n.d(t,{Sk:()=>s,kF:()=>a,mk:()=>r})},17044:(e,t,n)=>{n.d(t,{db:()=>h,u:()=>S});var s=n(57147),r=n(71017),a=n.n(r);let o=a().join(process.cwd(),"data");async function i(e){try{let t=a().join(o,e),n=await s.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return[]}}async function d(e){try{let t=a().join(o,e),n=await s.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return null}}async function u(e,t){let n=a().join(o,e);await s.promises.writeFile(n,JSON.stringify(t,null,2))}async function l(e,t){let n=a().join(o,e);await s.promises.writeFile(n,JSON.stringify(t,null,2))}let c={users:{getAll:()=>i("users.json"),findById:e=>i("users.json").then(t=>t.find(t=>t.id===e)),findByEmail:e=>i("users.json").then(t=>t.find(t=>t.email===e)),findByDocument:e=>i("users.json").then(t=>t.find(t=>t.document===e)),create:async e=>{let t=await i("users.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("users.json",t),n},update:async(e,t)=>{let n=await i("users.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("users.json",n),n[s])}},events:{getAll:()=>i("events.json"),findById:e=>i("events.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("events.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await i("events.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("events.json",t),n},update:async(e,t)=>{let n=await i("events.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("events.json",n),n[s])},delete:async e=>{let t=(await i("events.json")).filter(t=>t.id!==e);return await u("events.json",t),!0}},pastEvents:{getAll:()=>i("pastEvents.json"),findById:e=>i("pastEvents.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("pastEvents.json").then(t=>t.find(t=>t.slug===e)),findByEventId:e=>i("pastEvents.json").then(t=>t.find(t=>t.eventId===e)),create:async e=>{let t=await i("pastEvents.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:e.updatedAt??new Date().toISOString()};return t.push(n),await u("pastEvents.json",t),n},update:async(e,t)=>{let n=await i("pastEvents.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("pastEvents.json",n),n[s])}},listings:{getAll:()=>i("listings.json"),findById:e=>i("listings.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("listings.json").then(t=>t.find(t=>t.slug===e)),findByUser:e=>i("listings.json").then(t=>t.filter(t=>t.createdBy===e)),findByDocument:e=>i("listings.json").then(t=>t.filter(t=>t.document===e)),getActiveCount:e=>i("listings.json").then(t=>t.filter(t=>t.document===e&&"active"===t.status).length),create:async e=>{let t=await i("listings.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("listings.json",t),n},update:async(e,t)=>{let n=await i("listings.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("listings.json",n),n[s])},delete:async e=>{let t=(await i("listings.json")).filter(t=>t.id!==e);return await u("listings.json",t),!0},updateFeaturedStatus:async()=>{let e=await i("listings.json"),t=new Date;e.forEach(e=>{e.featured&&e.featuredUntil&&new Date(e.featuredUntil)<t&&(e.featured=!1,e.featuredUntil=void 0)}),await u("listings.json",e)}},comments:{getAll:()=>i("comments.json"),findByListing:e=>i("comments.json").then(t=>t.filter(t=>t.listingId===e&&"approved"===t.status)),findByEvent:e=>i("comments.json").then(t=>t.filter(t=>t.eventId===e&&"approved"===t.status)),getPending:()=>i("comments.json").then(e=>e.filter(e=>"pending"===e.status)),create:async e=>{let t=await i("comments.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("comments.json",t),n},update:async(e,t)=>{let n=await i("comments.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("comments.json",n),n[s])}},banners:{getAll:()=>i("banners.json"),findBySection:e=>i("banners.json").then(t=>t.filter(t=>t.section===e&&"active"===t.status)),create:async e=>{let t=await i("banners.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("banners.json",t),n},update:async(e,t)=>{let n=await i("banners.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("banners.json",n),n[s])},delete:async e=>{let t=(await i("banners.json")).filter(t=>t.id!==e);return await u("banners.json",t),!0}},news:{getAll:()=>i("news.json"),findById:e=>i("news.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("news.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await i("news.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await u("news.json",t),n},update:async(e,t)=>{let n=await i("news.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await u("news.json",n),n[s])},delete:async e=>{let t=(await i("news.json")).filter(t=>t.id!==e);return await u("news.json",t),!0}},settings:{get:()=>d("settings.json"),update:async e=>{let t={...await d("settings.json")||{},...e};return await l("settings.json",t),t}},vehicleCatalog:{get:()=>d("vehicleCatalog.json"),getBrands:()=>d("vehicleCatalog.json").then(e=>e?.brands||[]),getModels:e=>d("vehicleCatalog.json").then(t=>t?.brands.find(t=>t.id===e)?.models||[]),saveBrands:async e=>(await l("vehicleCatalog.json",{brands:e}),e),upsertBrand:async e=>{let t=await d("vehicleCatalog.json")||{brands:[]},n=t.brands.findIndex(t=>t.id===e.id);return n>=0?t.brands[n]={...t.brands[n],...e,models:e.models??t.brands[n].models}:t.brands.push({...e,models:e.models??[]}),await l("vehicleCatalog.json",t),t.brands},addModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},s=n.brands.find(t=>t.id===e);if(!s)return null;let r=t.trim();return r&&!s.models.includes(r)&&(s.models.push(r),s.models.sort((e,t)=>e.localeCompare(t)),await l("vehicleCatalog.json",n)),s.models},removeModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},s=n.brands.find(t=>t.id===e);return s?(s.models=s.models.filter(e=>e!==t),await l("vehicleCatalog.json",n),s.models):null},deleteBrand:async e=>{let t=(await d("vehicleCatalog.json")||{brands:[]}).brands.filter(t=>t.id!==e);return await l("vehicleCatalog.json",{brands:t}),t}}};var p=n(97402);let f="mysql"===process.env.DB_PROVIDER||!!process.env.MYSQL_URL||!!process.env.MYSQL_HOST,g=new Set,w="true"===process.env.DB_STRICT_MYSQL_ALL||"mysql"===process.env.DB_PROVIDER&&"false"!==process.env.DB_STRICT_MYSQL_ALL,j=["dbMysql.users."],y="MYSQL_REQUIRED";function m(e){return"object"==typeof e&&e&&"code"in e?String(e.code??"").toUpperCase():""}function S(e){return!!e&&"object"==typeof e&&("code"in e&&e.code===y||e instanceof Error&&e.message.toLowerCase().includes("mysql obrigatorio para operacao"))}let h=f?function e(t,n,s){return new Proxy(t,{get(t,r,a){let o=Reflect.get(t,r,a),i=Reflect.get(n,r),d=`${s}.${String(r)}`;return"function"==typeof o&&"function"==typeof i?async(...e)=>{try{return await o(...e)}catch(t){if(!function(e){let t=m(e);if("ER_ACCESS_DENIED_ERROR"===t||"ER_HOST_NOT_PRIVILEGED"===t||"ER_BAD_DB_ERROR"===t||"ECONNREFUSED"===t||"ENOTFOUND"===t||"ETIMEDOUT"===t||"ECONNRESET"===t||"PROTOCOL_CONNECTION_LOST"===t)return!0;if(!(e instanceof Error))return!1;let n=e.message.toLowerCase();return n.includes("access denied")||n.includes("mysql nao configurado")||n.includes("mysql n\xe3o configurado")||n.includes("connect econnrefused")||n.includes("enotfound")||n.includes("etimedout")||n.includes("connection lost")}(t))throw t;return(w||j.some(e=>d.startsWith(e)))&&function(e,t){let n=Error(`MySQL obrigatorio para operacao (${e}).`);throw n.code=y,n.cause=t,n}(d,t),function(e,t){if(g.has(e))return;g.add(e);let n=m(t),s=t instanceof Error?t.message:String(t);console.warn(`[db] MySQL indisponivel em ${e}${n?` (${n})`:""}; usando dbFile. Motivo: ${s}`)}(d,t),await i(...e)}}:o&&i&&"object"==typeof o&&"object"==typeof i?e(o,i,d):o}})}(p.t,c,"dbMysql"):c}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[8948,3785,5972,9183],()=>n(56878));module.exports=s})();