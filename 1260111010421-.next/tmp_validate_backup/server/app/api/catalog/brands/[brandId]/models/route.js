"use strict";(()=>{var e={};e.id=4177,e.ids=[4177],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},99012:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>j,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>m,staticGenerationAsyncStorage:()=>w});var r={};n.r(r),n.d(r,{DELETE:()=>p,GET:()=>u,POST:()=>c});var s=n(43410),a=n(88716),o=n(60670),i=n(87070),d=n(17044),l=n(2095);async function u(e,{params:t}){try{let e=await d.db.vehicleCatalog.getModels(t.brandId);return i.NextResponse.json({models:e})}catch(e){return console.error("Erro ao buscar modelos:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function c(e,{params:t}){try{var n;(0,l.kF)(e);let r=await e.json(),s="string"==typeof r.model?r.model.trim():"",a=Array.from(new Set([...s?[s]:[],...(n=r.models,Array.isArray(n)?Array.from(new Set(n.filter(e=>"string"==typeof e).map(e=>e.trim()).filter(Boolean))).sort((e,t)=>e.localeCompare(t)):[])])).sort((e,t)=>e.localeCompare(t));if(0===a.length)return i.NextResponse.json({error:"Modelo \xe9 obrigat\xf3rio"},{status:400});let o=(await d.db.vehicleCatalog.getBrands()).find(e=>e.id===t.brandId);if(!o)return i.NextResponse.json({error:"Marca n\xe3o encontrada"},{status:404});let u=Array.isArray(o.models)?o.models:[],c=Array.from(new Set([...u,...a])).sort((e,t)=>e.localeCompare(t));return await d.db.vehicleCatalog.upsertBrand({...o,models:c}),i.NextResponse.json({models:c,addedCount:c.length-u.length})}catch(e){if(console.error("Erro ao adicionar modelo:",e),e instanceof Error&&"Acesso negado"===e.message)return i.NextResponse.json({error:"Acesso negado"},{status:401});return i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function p(e,{params:t}){try{(0,l.kF)(e);let n=await e.json(),r=n.model?.toString().trim();if(!r)return i.NextResponse.json({error:"Modelo \xe9 obrigat\xf3rio"},{status:400});let s=await d.db.vehicleCatalog.removeModel(t.brandId,r);if(!s)return i.NextResponse.json({error:"Marca n\xe3o encontrada"},{status:404});return i.NextResponse.json({models:s})}catch(e){if(console.error("Erro ao remover modelo:",e),e instanceof Error&&"Acesso negado"===e.message)return i.NextResponse.json({error:"Acesso negado"},{status:401});return i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/catalog/brands/[brandId]/models/route",pathname:"/api/catalog/brands/[brandId]/models",filename:"route",bundlePath:"app/api/catalog/brands/[brandId]/models/route"},resolvedPagePath:"C:\\Users\\lucas\\OneDrive\\Documentos\\GitHub\\AutoGarageShowV1\\src\\app\\api\\catalog\\brands\\[brandId]\\models\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:m}=g,j="/api/catalog/brands/[brandId]/models/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:w})}},2095:(e,t,n)=>{function r(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;let n=t.substring(7);return JSON.parse(atob(n))}catch{return null}}function s(e){let t=r(e);if(!t)throw Error("N\xe3o autorizado");return t}function a(e){let t=s(e);if("admin"!==t.role)throw Error("Acesso negado");return t}n.d(t,{Sk:()=>r,kF:()=>a,mk:()=>s})},17044:(e,t,n)=>{n.d(t,{db:()=>h,u:()=>S});var r=n(57147),s=n(71017),a=n.n(s);let o=a().join(process.cwd(),"data");async function i(e){try{let t=a().join(o,e),n=await r.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return[]}}async function d(e){try{let t=a().join(o,e),n=await r.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return null}}async function l(e,t){let n=a().join(o,e);await r.promises.writeFile(n,JSON.stringify(t,null,2))}async function u(e,t){let n=a().join(o,e);await r.promises.writeFile(n,JSON.stringify(t,null,2))}let c={users:{getAll:()=>i("users.json"),findById:e=>i("users.json").then(t=>t.find(t=>t.id===e)),findByEmail:e=>i("users.json").then(t=>t.find(t=>t.email===e)),findByDocument:e=>i("users.json").then(t=>t.find(t=>t.document===e)),create:async e=>{let t=await i("users.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("users.json",t),n},update:async(e,t)=>{let n=await i("users.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("users.json",n),n[r])}},events:{getAll:()=>i("events.json"),findById:e=>i("events.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("events.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await i("events.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("events.json",t),n},update:async(e,t)=>{let n=await i("events.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("events.json",n),n[r])},delete:async e=>{let t=(await i("events.json")).filter(t=>t.id!==e);return await l("events.json",t),!0}},pastEvents:{getAll:()=>i("pastEvents.json"),findById:e=>i("pastEvents.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("pastEvents.json").then(t=>t.find(t=>t.slug===e)),findByEventId:e=>i("pastEvents.json").then(t=>t.find(t=>t.eventId===e)),create:async e=>{let t=await i("pastEvents.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:e.updatedAt??new Date().toISOString()};return t.push(n),await l("pastEvents.json",t),n},update:async(e,t)=>{let n=await i("pastEvents.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("pastEvents.json",n),n[r])}},listings:{getAll:()=>i("listings.json"),findById:e=>i("listings.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("listings.json").then(t=>t.find(t=>t.slug===e)),findByUser:e=>i("listings.json").then(t=>t.filter(t=>t.createdBy===e)),findByDocument:e=>i("listings.json").then(t=>t.filter(t=>t.document===e)),getActiveCount:e=>i("listings.json").then(t=>t.filter(t=>t.document===e&&"active"===t.status).length),create:async e=>{let t=await i("listings.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("listings.json",t),n},update:async(e,t)=>{let n=await i("listings.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("listings.json",n),n[r])},delete:async e=>{let t=(await i("listings.json")).filter(t=>t.id!==e);return await l("listings.json",t),!0},updateFeaturedStatus:async()=>{let e=await i("listings.json"),t=new Date;e.forEach(e=>{e.featured&&e.featuredUntil&&new Date(e.featuredUntil)<t&&(e.featured=!1,e.featuredUntil=void 0)}),await l("listings.json",e)}},comments:{getAll:()=>i("comments.json"),findByListing:e=>i("comments.json").then(t=>t.filter(t=>t.listingId===e&&"approved"===t.status)),findByEvent:e=>i("comments.json").then(t=>t.filter(t=>t.eventId===e&&"approved"===t.status)),getPending:()=>i("comments.json").then(e=>e.filter(e=>"pending"===e.status)),create:async e=>{let t=await i("comments.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("comments.json",t),n},update:async(e,t)=>{let n=await i("comments.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("comments.json",n),n[r])}},banners:{getAll:()=>i("banners.json"),findBySection:e=>i("banners.json").then(t=>t.filter(t=>t.section===e&&"active"===t.status)),create:async e=>{let t=await i("banners.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("banners.json",t),n},update:async(e,t)=>{let n=await i("banners.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("banners.json",n),n[r])},delete:async e=>{let t=(await i("banners.json")).filter(t=>t.id!==e);return await l("banners.json",t),!0}},news:{getAll:()=>i("news.json"),findById:e=>i("news.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>i("news.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await i("news.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("news.json",t),n},update:async(e,t)=>{let n=await i("news.json"),r=n.findIndex(t=>t.id===e);return -1===r?null:(n[r]={...n[r],...t,updatedAt:new Date().toISOString()},await l("news.json",n),n[r])},delete:async e=>{let t=(await i("news.json")).filter(t=>t.id!==e);return await l("news.json",t),!0}},settings:{get:()=>d("settings.json"),update:async e=>{let t={...await d("settings.json")||{},...e};return await u("settings.json",t),t}},vehicleCatalog:{get:()=>d("vehicleCatalog.json"),getBrands:()=>d("vehicleCatalog.json").then(e=>e?.brands||[]),getModels:e=>d("vehicleCatalog.json").then(t=>t?.brands.find(t=>t.id===e)?.models||[]),saveBrands:async e=>(await u("vehicleCatalog.json",{brands:e}),e),upsertBrand:async e=>{let t=await d("vehicleCatalog.json")||{brands:[]},n=t.brands.findIndex(t=>t.id===e.id);return n>=0?t.brands[n]={...t.brands[n],...e,models:e.models??t.brands[n].models}:t.brands.push({...e,models:e.models??[]}),await u("vehicleCatalog.json",t),t.brands},addModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},r=n.brands.find(t=>t.id===e);if(!r)return null;let s=t.trim();return s&&!r.models.includes(s)&&(r.models.push(s),r.models.sort((e,t)=>e.localeCompare(t)),await u("vehicleCatalog.json",n)),r.models},removeModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},r=n.brands.find(t=>t.id===e);return r?(r.models=r.models.filter(e=>e!==t),await u("vehicleCatalog.json",n),r.models):null},deleteBrand:async e=>{let t=(await d("vehicleCatalog.json")||{brands:[]}).brands.filter(t=>t.id!==e);return await u("vehicleCatalog.json",{brands:t}),t}}};var p=n(97402);let g="mysql"===process.env.DB_PROVIDER||!!process.env.MYSQL_URL||!!process.env.MYSQL_HOST,f=new Set,w="true"===process.env.DB_STRICT_MYSQL_ALL||"mysql"===process.env.DB_PROVIDER&&"false"!==process.env.DB_STRICT_MYSQL_ALL,m=["dbMysql.users."],j="MYSQL_REQUIRED";function y(e){return"object"==typeof e&&e&&"code"in e?String(e.code??"").toUpperCase():""}function S(e){return!!e&&"object"==typeof e&&("code"in e&&e.code===j||e instanceof Error&&e.message.toLowerCase().includes("mysql obrigatorio para operacao"))}let h=g?function e(t,n,r){return new Proxy(t,{get(t,s,a){let o=Reflect.get(t,s,a),i=Reflect.get(n,s),d=`${r}.${String(s)}`;return"function"==typeof o&&"function"==typeof i?async(...e)=>{try{return await o(...e)}catch(t){if(!function(e){let t=y(e);if("ER_ACCESS_DENIED_ERROR"===t||"ER_HOST_NOT_PRIVILEGED"===t||"ER_BAD_DB_ERROR"===t||"ECONNREFUSED"===t||"ENOTFOUND"===t||"ETIMEDOUT"===t||"ECONNRESET"===t||"PROTOCOL_CONNECTION_LOST"===t)return!0;if(!(e instanceof Error))return!1;let n=e.message.toLowerCase();return n.includes("access denied")||n.includes("mysql nao configurado")||n.includes("mysql n\xe3o configurado")||n.includes("connect econnrefused")||n.includes("enotfound")||n.includes("etimedout")||n.includes("connection lost")}(t))throw t;return(w||m.some(e=>d.startsWith(e)))&&function(e,t){let n=Error(`MySQL obrigatorio para operacao (${e}).`);throw n.code=j,n.cause=t,n}(d,t),function(e,t){if(f.has(e))return;f.add(e);let n=y(t),r=t instanceof Error?t.message:String(t);console.warn(`[db] MySQL indisponivel em ${e}${n?` (${n})`:""}; usando dbFile. Motivo: ${r}`)}(d,t),await i(...e)}}:o&&i&&"object"==typeof o&&"object"==typeof i?e(o,i,d):o}})}(p.t,c,"dbMysql"):c}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,3785,5972,9183],()=>n(99012));module.exports=r})();