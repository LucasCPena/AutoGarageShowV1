"use strict";(()=>{var e={};e.id=3616,e.ids=[3616],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},11915:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var s={};n.r(s),n.d(s,{POST:()=>u});var a=n(43410),r=n(88716),i=n(60670),o=n(87070),d=n(17044),l=n(2095);async function u(e,{params:t}){try{(0,l.kF)(e);let{action:n}=await e.json();if(!["approve","complete","delete"].includes(n))return o.NextResponse.json({error:'Acao invalida. Use "approve", "complete" ou "delete".'},{status:400});let s=await d.db.events.findById(t.id);if(!s)return o.NextResponse.json({error:"Evento nao encontrado"},{status:404});if("delete"===n)return await d.db.events.delete(t.id),o.NextResponse.json({message:"Evento excluido com sucesso"});if("complete"===n){let e=await d.db.pastEvents.findByEventId(s.id),t=e?.images??s.images??[],n=e?.videos??[];if(!function(e=[],t=[]){return e.length>0||t.length>0}(t,n))return o.NextResponse.json({error:"Adicione fotos ou videos no evento antes de marcar como realizado."},{status:400});if(e)await d.db.pastEvents.update(e.id,{title:s.title,city:s.city,state:s.state,date:s.startAt,images:t,videos:n,description:e.description||s.description});else{let e=s.slug||s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-"),a=await d.db.pastEvents.getAll();for(;a.some(t=>t.slug===e);)e=`${e}-${crypto.randomUUID().slice(0,4)}`;await d.db.pastEvents.create({eventId:s.id,slug:e,title:s.title,city:s.city,state:s.state,date:s.startAt,images:t,videos:n,description:s.description,attendance:0,updatedAt:new Date().toISOString()})}}let a=await d.db.events.update(t.id,{status:"approve"===n?"approved":"completed"});return o.NextResponse.json({event:a,message:"approve"===n?"Evento aprovado e publicado.":"Evento marcado como realizado."})}catch(e){if(console.error("Erro ao aprovar/rejeitar evento:",e),e instanceof Error)return o.NextResponse.json({error:e.message},{status:401});return o.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/events/[id]/approve/route",pathname:"/api/admin/events/[id]/approve",filename:"route",bundlePath:"app/api/admin/events/[id]/approve/route"},resolvedPagePath:"C:\\Users\\lucas\\OneDrive\\Documentos\\GitHub\\AutoGarageShowV1\\src\\app\\api\\admin\\events\\[id]\\approve\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:g}=c,w="/api/admin/events/[id]/approve/route";function v(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},2095:(e,t,n)=>{function s(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;let n=t.substring(7);return JSON.parse(atob(n))}catch{return null}}function a(e){let t=s(e);if(!t)throw Error("N\xe3o autorizado");return t}function r(e){let t=a(e);if("admin"!==t.role)throw Error("Acesso negado");return t}n.d(t,{Sk:()=>s,kF:()=>r,mk:()=>a})},17044:(e,t,n)=>{n.d(t,{db:()=>S,u:()=>y});var s=n(57147),a=n(71017),r=n.n(a);let i=r().join(process.cwd(),"data");async function o(e){try{let t=r().join(i,e),n=await s.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return[]}}async function d(e){try{let t=r().join(i,e),n=await s.promises.readFile(t,"utf-8");return JSON.parse(n)}catch{return null}}async function l(e,t){let n=r().join(i,e);await s.promises.writeFile(n,JSON.stringify(t,null,2))}async function u(e,t){let n=r().join(i,e);await s.promises.writeFile(n,JSON.stringify(t,null,2))}let c={users:{getAll:()=>o("users.json"),findById:e=>o("users.json").then(t=>t.find(t=>t.id===e)),findByEmail:e=>o("users.json").then(t=>t.find(t=>t.email===e)),findByDocument:e=>o("users.json").then(t=>t.find(t=>t.document===e)),create:async e=>{let t=await o("users.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("users.json",t),n},update:async(e,t)=>{let n=await o("users.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("users.json",n),n[s])}},events:{getAll:()=>o("events.json"),findById:e=>o("events.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>o("events.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await o("events.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("events.json",t),n},update:async(e,t)=>{let n=await o("events.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("events.json",n),n[s])},delete:async e=>{let t=(await o("events.json")).filter(t=>t.id!==e);return await l("events.json",t),!0}},pastEvents:{getAll:()=>o("pastEvents.json"),findById:e=>o("pastEvents.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>o("pastEvents.json").then(t=>t.find(t=>t.slug===e)),findByEventId:e=>o("pastEvents.json").then(t=>t.find(t=>t.eventId===e)),create:async e=>{let t=await o("pastEvents.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:e.updatedAt??new Date().toISOString()};return t.push(n),await l("pastEvents.json",t),n},update:async(e,t)=>{let n=await o("pastEvents.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("pastEvents.json",n),n[s])}},listings:{getAll:()=>o("listings.json"),findById:e=>o("listings.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>o("listings.json").then(t=>t.find(t=>t.slug===e)),findByUser:e=>o("listings.json").then(t=>t.filter(t=>t.createdBy===e)),findByDocument:e=>o("listings.json").then(t=>t.filter(t=>t.document===e)),getActiveCount:e=>o("listings.json").then(t=>t.filter(t=>t.document===e&&"active"===t.status).length),create:async e=>{let t=await o("listings.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("listings.json",t),n},update:async(e,t)=>{let n=await o("listings.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("listings.json",n),n[s])},delete:async e=>{let t=(await o("listings.json")).filter(t=>t.id!==e);return await l("listings.json",t),!0},updateFeaturedStatus:async()=>{let e=await o("listings.json"),t=new Date;e.forEach(e=>{e.featured&&e.featuredUntil&&new Date(e.featuredUntil)<t&&(e.featured=!1,e.featuredUntil=void 0)}),await l("listings.json",e)}},comments:{getAll:()=>o("comments.json"),findByListing:e=>o("comments.json").then(t=>t.filter(t=>t.listingId===e&&"approved"===t.status)),findByEvent:e=>o("comments.json").then(t=>t.filter(t=>t.eventId===e&&"approved"===t.status)),getPending:()=>o("comments.json").then(e=>e.filter(e=>"pending"===e.status)),create:async e=>{let t=await o("comments.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("comments.json",t),n},update:async(e,t)=>{let n=await o("comments.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("comments.json",n),n[s])}},banners:{getAll:()=>o("banners.json"),findBySection:e=>o("banners.json").then(t=>t.filter(t=>t.section===e&&"active"===t.status)),create:async e=>{let t=await o("banners.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("banners.json",t),n},update:async(e,t)=>{let n=await o("banners.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("banners.json",n),n[s])},delete:async e=>{let t=(await o("banners.json")).filter(t=>t.id!==e);return await l("banners.json",t),!0}},news:{getAll:()=>o("news.json"),findById:e=>o("news.json").then(t=>t.find(t=>t.id===e)),findBySlug:e=>o("news.json").then(t=>t.find(t=>t.slug===e)),create:async e=>{let t=await o("news.json"),n={...e,id:crypto.randomUUID(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(n),await l("news.json",t),n},update:async(e,t)=>{let n=await o("news.json"),s=n.findIndex(t=>t.id===e);return -1===s?null:(n[s]={...n[s],...t,updatedAt:new Date().toISOString()},await l("news.json",n),n[s])},delete:async e=>{let t=(await o("news.json")).filter(t=>t.id!==e);return await l("news.json",t),!0}},settings:{get:()=>d("settings.json"),update:async e=>{let t={...await d("settings.json")||{},...e};return await u("settings.json",t),t}},vehicleCatalog:{get:()=>d("vehicleCatalog.json"),getBrands:()=>d("vehicleCatalog.json").then(e=>e?.brands||[]),getModels:e=>d("vehicleCatalog.json").then(t=>t?.brands.find(t=>t.id===e)?.models||[]),saveBrands:async e=>(await u("vehicleCatalog.json",{brands:e}),e),upsertBrand:async e=>{let t=await d("vehicleCatalog.json")||{brands:[]},n=t.brands.findIndex(t=>t.id===e.id);return n>=0?t.brands[n]={...t.brands[n],...e,models:e.models??t.brands[n].models}:t.brands.push({...e,models:e.models??[]}),await u("vehicleCatalog.json",t),t.brands},addModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},s=n.brands.find(t=>t.id===e);if(!s)return null;let a=t.trim();return a&&!s.models.includes(a)&&(s.models.push(a),s.models.sort((e,t)=>e.localeCompare(t)),await u("vehicleCatalog.json",n)),s.models},removeModel:async(e,t)=>{let n=await d("vehicleCatalog.json")||{brands:[]},s=n.brands.find(t=>t.id===e);return s?(s.models=s.models.filter(e=>e!==t),await u("vehicleCatalog.json",n),s.models):null},deleteBrand:async e=>{let t=(await d("vehicleCatalog.json")||{brands:[]}).brands.filter(t=>t.id!==e);return await u("vehicleCatalog.json",{brands:t}),t}}};var p=n(97402);let f="mysql"===process.env.DB_PROVIDER||!!process.env.MYSQL_URL||!!process.env.MYSQL_HOST,g=new Set,w="true"===process.env.DB_STRICT_MYSQL_ALL||"mysql"===process.env.DB_PROVIDER&&"false"!==process.env.DB_STRICT_MYSQL_ALL,v=["dbMysql.users."],j="MYSQL_REQUIRED";function m(e){return"object"==typeof e&&e&&"code"in e?String(e.code??"").toUpperCase():""}function y(e){return!!e&&"object"==typeof e&&("code"in e&&e.code===j||e instanceof Error&&e.message.toLowerCase().includes("mysql obrigatorio para operacao"))}let S=f?function e(t,n,s){return new Proxy(t,{get(t,a,r){let i=Reflect.get(t,a,r),o=Reflect.get(n,a),d=`${s}.${String(a)}`;return"function"==typeof i&&"function"==typeof o?async(...e)=>{try{return await i(...e)}catch(t){if(!function(e){let t=m(e);if("ER_ACCESS_DENIED_ERROR"===t||"ER_HOST_NOT_PRIVILEGED"===t||"ER_BAD_DB_ERROR"===t||"ECONNREFUSED"===t||"ENOTFOUND"===t||"ETIMEDOUT"===t||"ECONNRESET"===t||"PROTOCOL_CONNECTION_LOST"===t)return!0;if(!(e instanceof Error))return!1;let n=e.message.toLowerCase();return n.includes("access denied")||n.includes("mysql nao configurado")||n.includes("mysql n\xe3o configurado")||n.includes("connect econnrefused")||n.includes("enotfound")||n.includes("etimedout")||n.includes("connection lost")}(t))throw t;return(w||v.some(e=>d.startsWith(e)))&&function(e,t){let n=Error(`MySQL obrigatorio para operacao (${e}).`);throw n.code=j,n.cause=t,n}(d,t),function(e,t){if(g.has(e))return;g.add(e);let n=m(t),s=t instanceof Error?t.message:String(t);console.warn(`[db] MySQL indisponivel em ${e}${n?` (${n})`:""}; usando dbFile. Motivo: ${s}`)}(d,t),await o(...e)}}:i&&o&&"object"==typeof i&&"object"==typeof o?e(i,o,d):i}})}(p.t,c,"dbMysql"):c}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[8948,3785,5972,9183],()=>n(11915));module.exports=s})();